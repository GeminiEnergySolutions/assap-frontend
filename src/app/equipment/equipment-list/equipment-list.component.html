<input
  type="search"
  class="form-control mb-3"
  [placeholder]="'Search ' + (equipments?.length ?? 0) + ' ' + category?.equipmentName"
  [(ngModel)]="search"
/>
<a routerLink="new" class="btn btn-outline-secondary bi-plus mb-3 w-100">
  Add {{ category?.equipmentName }}
</a>
@if (equipments) {
  @for (item of equipments | search:search:['name']; track item.id) {
    <app-feature-card
      [title]="item.name | titlecase"
      [subtitle]="item.type.name"
      [routerLink]="['types', item.id]"
      routerLinkActive="active"
      [percentageQuery]="{progressType: 'equipmentForm', auditId: item.auditId, zoneId: item.zoneId, subTypeId: item.id}"
    >
      <div options style="z-index: 900">
        <app-equipment-options-dropdown [equipment]="item" (click)="$event.stopImmediatePropagation(); $event.preventDefault()">
          <button ngbDropdownItem class="bi-copy" (click)="duplicate(item)">
            Duplicate
          </button>
          <button ngbDropdownItem class="bi-copy" (click)="toDuplicate = item; loadZones(); modal.open(duplicateModal)">
            Duplicate to...
          </button>
          <div class="dropdown-divider"></div>
          <button ngbDropdownItem class="bi-trash text-danger" (click)="delete(item)">
            Delete
          </button>
        </app-equipment-options-dropdown>
      </div>
    </app-feature-card>
  } @empty {
    <div class="text-center">
      No {{ category?.equipmentName }} yet.
    </div>
  }
} @else {
  <app-list-placeholder></app-list-placeholder>
}

<ng-template #duplicateModal let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">
      Duplicate
      {{ toDuplicate?.type?.name }}
    </h4>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
  </div>
  <div class="modal-body">
    <div class="mb-3">
      <label for="new-name" class="form-label">
        New Name
      </label>
      <input type="text" id="new-name" class="form-control" #newName [placeholder]="toDuplicate?.name">
      <div class="form-text">
        Enter a new name for the duplicated equipment.
        If left empty, the original name will be used.
      </div>
    </div>
    <div class="mb-3">
      <label for="zone" class="form-label">
        Zone
        <span class="text-danger" ngbTooltip="Required">*</span>
      </label>
      <select class="form-select" id="zone" #zoneSelect>
        @for (zone of zones; track zone.zoneId) {
          <option [value]="zone.zoneId">{{ zone.zoneName }}</option>
        }
      </select>
      <div class="form-text">
        Select the zone where the equipment will be duplicated.
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.dismiss()">Cancel</button>
    <button type="button" class="btn btn-primary" (click)="duplicate(toDuplicate!, +zoneSelect.value, newName.value); modal.close()">Duplicate</button>
  </div>
</ng-template>
