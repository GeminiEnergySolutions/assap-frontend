(self.webpackChunkconserve=self.webpackChunkconserve||[]).push([[747],{747:(e,t,i)=>{"use strict";i.r(t),i.d(t,{AuditsModule:()=>ze});var n=i(8358),r=i(8775),o=i(5161),a=i(7026),s=i(7320);let c=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=s.oAB({type:e}),e.\u0275inj=s.cJS({imports:[[n.ez,o.JF,a.u5,r.Gs]]}),e})();var u=i(5518);let d=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=s.oAB({type:e}),e.\u0275inj=s.cJS({imports:[[n.ez,u.Bz,r.XC]]}),e})();var l=i(3989),p=i(9613),f=i(5895),g=i(8362);function m(e){return t=>t.lift(new h(e))}class h{constructor(e){this.value=e}call(e,t){return t.subscribe(new v(e,this.value))}}class v extends g.L{constructor(e,t){super(e),this.value=t}_next(e){this.destination.next(this.value)}}var b=i(5286);let y=(()=>{class e{constructor(){}findAll(e){const t=[];e:for(let i=0;i<localStorage.length;i++){const n=localStorage.key(i);if(!n.startsWith("audits/")||n.indexOf("/","audits/".length)>=0)continue;const r=localStorage.getItem(n),o=JSON.parse(r);if(e)for(const t of Object.keys(e))if(o[t]!==e[t])continue e;t.push(o)}return t}findOne(e){const t=localStorage.getItem(`audits/${e}`);if(t)return JSON.parse(t)}getDeltas(e){const t={};for(let i=0;i<localStorage.length;i++){const n=localStorage.key(i),r=new RegExp(`^audits/${e}/delta/(d+)$`).exec(n);if(!r)continue;const[,o]=r,a=localStorage.getItem(n);t[o]=JSON.parse(a)}return Object.entries(t).sort((e,t)=>+e[0]-+t[0]).map(([,e])=>e)}save(e){this.deleteDeltas(e),localStorage.setItem(`audits/${e.auditId}`,JSON.stringify(e))}update(e,t,i){const n=`audits/${e.auditId}`;if(!localStorage.getItem(n))return;const r=i?i(e):e;if(r.pendingChanges=(r.pendingChanges||0)+(t?1:0),localStorage.setItem(n,JSON.stringify(r)),t){const e=`audits/${r.auditId}/delta/${+new Date}`;localStorage.setItem(e,JSON.stringify(t))}return r}deleteDeltas(e){this.deleteWithPrefix(`audits/${e.auditId}/delta`),e.pendingChanges=0}delete(e){this.deleteWithPrefix(`audits/${e.auditId}`),delete e.pendingChanges}deleteWithPrefix(e){for(let t=localStorage.length-1;t>=0;t--){const i=localStorage.key(t);i.startsWith(e)&&localStorage.removeItem(i)}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=s.Yz7({token:e,factory:e.\u0275fac}),e})(),Z=(()=>{class e{constructor(){}randomIdAndMod(){const e=(new Date).valueOf();return{id:e/1e3|0,mod:e}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=s.Yz7({token:e,factory:e.\u0275fac}),e})();var A=i(4279);let S=(()=>{class e{constructor(e,t){this.idService=e,this.parseService=t}findAll(e={}){return this.parseService.findAll("rAudit",e)}create(e){const{id:t,mod:i}=this.idService.randomIdAndMod(),n=Object.assign({auditId:t.toString(),mod:i.toString(),usn:0},e);return this.parseService.create("rAudit",n)}update(e,t){return this.parseService.update("rAudit",e,t).pipe(m(void 0))}updateMany(e,t){return this.parseService.batch(t.map(t=>({method:"PUT",path:`/classes/rAudit/${e}`,body:t}))).pipe(m(void 0))}delete({objectId:e}){return this.parseService.delete("rAudit",e)}}return e.\u0275fac=function(t){return new(t||e)(s.LFG(Z),s.LFG(A.X))},e.\u0275prov=s.Yz7({token:e,factory:e.\u0275fac}),e})(),x=(()=>{class e{constructor(e,t){this.offlineAuditService=e,this.parseAuditService=t}findAll(e={}){const t=this.offlineAuditService.findAll(e);return this.parseAuditService.findAll(e).pipe((0,p.K)(()=>(0,l.of)([])),(0,f.U)(e=>this.mergeAll([...e,...t])))}findOne(e){const t=this.offlineAuditService.findOne(e);return this.parseAuditService.findAll({auditId:e}).pipe((0,p.K)(()=>(0,l.of)([])),(0,f.U)(e=>this.mergeAll(t?[...e,t]:e)),(0,f.U)(e=>e[0]))}mergeAll(e){if(e.length<=1)return e;const t=new Map;for(const i of e){const e=i.auditId,n=t.get(e);if(!n){t.set(e,i);continue}let r;r=n.updatedAt<=i.updatedAt?this.merge(n,i):this.merge(i,n),t.set(e,r)}return[...t.values()]}merge(e,t){return Object.assign(Object.assign(Object.assign({},e),t),{type:Object.assign(Object.assign({},e.type),t.type),zone:Object.assign(Object.assign({},e.zone),t.zone)})}create(e){return this.parseAuditService.create(e)}update(e,t,i){const n=this.offlineAuditService.update(e,t,i);return n?(0,l.of)(n):this.parseAuditService.update(e.objectId,t).pipe(m(e),(0,f.U)(i))}upload(e){const t=this.offlineAuditService.getDeltas(e.auditId);return this.parseAuditService.updateMany(e.objectId,t).pipe((0,b.b)(()=>this.offlineAuditService.deleteDeltas(e)))}delete(e){return this.parseAuditService.delete(e)}}return e.\u0275fac=function(t){return new(t||e)(s.LFG(y),s.LFG(S))},e.\u0275prov=s.Yz7({token:e,factory:e.\u0275fac}),e})(),w=(()=>{class e{canDeactivate(e){return e.isSaved()||confirm("Are you sure you want to leave this page? Changes that you made may not be saved.")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=s.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var I=i(7341),T=i(4805),O=i(7621);let k=(()=>{class e{constructor(e){this.parseService=e}findAll(e={},t){return this.parseService.findAll("rFeature",e,{keys:t})}create(e){return this.parseService.create("rFeature",e)}update(e,t){return this.parseService.update("rFeature",e,t).pipe(m(void 0))}delete(e){return this.parseService.delete("rFeature",e)}deleteAll(e={}){return this.findAll(e,["objectId"]).pipe((0,T.w)(e=>{const t=e.map(e=>({method:"DELETE",path:"/parse/classes/rFeature/"+e.objectId}));return this.parseService.batch(t)}))}}return e.\u0275fac=function(t){return new(t||e)(s.LFG(A.X))},e.\u0275prov=s.Yz7({token:e,factory:e.\u0275fac}),e})(),q=(()=>{class e{constructor(){}findAll(e){if(e.auditId&&!e.typeId){const t=localStorage.getItem(`audits/${e.auditId}/features/preaudit`);return t?[JSON.parse(t)]:[]}const t=new RegExp(`^audits/${e.auditId||"\\w+"}/features/${e.typeId||"preaudit"}$`),i=[];e:for(let n=0;n<localStorage.length;n++){const r=localStorage.key(n);if(!t.test(r))continue;const o=localStorage.getItem(r),a=JSON.parse(o);for(const t of Object.keys(e))if(a[t]!==e[t])continue e;i.push(a)}return i}save(e){const t=this.getKey(e);localStorage.setItem(t,JSON.stringify(e))}update(e,t){const i=this.getKey(e);if(!localStorage.getItem(i))return;const n=Object.assign(Object.assign({},e),t);return localStorage.setItem(i,JSON.stringify(n)),n}getKey(e){return`audits/${e.auditId}/features/${e.typeId||"preaudit"}`}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=s.Yz7({token:e,factory:e.\u0275fac}),e})();const N="\x1f";let F=(()=>{class e{constructor(e,t,i,n){this.parseService=e,this.parseFeatureService=t,this.offlineFeatureService=i,this.offlineAuditService=n}findAll(e={},t){const i=this.offlineFeatureService.findAll(e);return i.length>=0?(0,l.of)(i):this.parseFeatureService.findAll(e,t)}saveAll(e){this.parseFeatureService.findAll(e).subscribe(e=>{for(const t of e)this.offlineFeatureService.save(t)})}create(e){if(this.offlineAuditService.findOne(e.auditId)){const t=(parseInt("local",36)+Math.random()).toString(36),i=(new Date).toJSON(),n=Object.assign({objectId:t,createdAt:i,updatedAt:i},e);return this.offlineFeatureService.save(n),(0,l.of)(n)}return this.parseFeatureService.create(e)}update(e,t){const i=this.offlineFeatureService.update(e,t);return i?(0,l.of)(i):this.parseFeatureService.update(e.objectId,t).pipe(m(Object.assign(Object.assign({},e),t)))}upload(e){const t=this.offlineFeatureService.findAll(e);return this.parseService.batch(t.map(e=>{const{objectId:t}=e,i=(0,O._T)(e,["objectId","createdAt","updatedAt"]);return t.startsWith("local.")?{path:"/classes/rFeature",method:"POST",body:i}:{path:`/classes/rFeature/${t}`,method:"PUT",body:i}})).pipe((0,f.U)(e=>{for(let i=0;i<e.length;i++){const n=e[i],r=t[i];if("error"in n)continue;const o=n.success;"objectId"in o&&(r.objectId=o.objectId),"createdAt"in o&&(r.createdAt=o.createdAt),"updatedAt"in o&&(r.updatedAt=o.updatedAt),this.offlineFeatureService.save(r)}}))}delete(e){return this.parseFeatureService.delete(e.objectId)}deleteAll(e={}){return this.parseFeatureService.deleteAll(e)}feature2Data(e){const t={},i=e.formId.split(N),n=e.values.split(N),r=Math.min(i.length,n.length);for(let o=0;o<r;o++)t[i[o]]=n[o];return t}data2Feature(e,t){const i=Object.entries(t),n=i.map(([e])=>e),r=n.map(t=>this.findElement(e,t));return{id:i.map((e,t)=>t).join(N),dataType:r.map(e=>e.dataType).join(N),fields:r.map(e=>e.param).join(N),formId:n.join(N),values:i.map(e=>e[1]).join(N)}}findElement(e,t){for(let i of e.geminiForm)for(let e of i.elements)if(e.id===t)return e}}return e.\u0275fac=function(t){return new(t||e)(s.LFG(A.X),s.LFG(k),s.LFG(q),s.LFG(y))},e.\u0275prov=s.Yz7({token:e,factory:e.\u0275fac}),e})(),J=(()=>{class e{constructor(e,t){this.http=e,this.parseService=t}loadSchema(e){return this.parseService.findAll("Form",{name:e},{limit:1,order:["-updatedAt"]}).pipe((0,T.w)(t=>t.length?(0,l.of)(t[0]):this.http.get(`/assets/${e}.json`)))}}return e.\u0275fac=function(t){return new(t||e)(s.LFG(o.eN),s.LFG(A.X))},e.\u0275prov=s.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),_=(()=>{class e{transform(t){return e.mapping[t]||"text"}}return e.mapping={emailrow:"email",phonerow:"tel",introw:"number",decimalrow:"number"},e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=s.Yjl({name:"formInputType",type:e,pure:!0}),e})();function z(e,t){if(1&e&&(s.TgZ(0,"option",15),s._uU(1),s.qZA()),2&e){const e=t.$implicit;s.Q6J("value",e.substring(e.indexOf(":")+1)),s.xp6(1),s.hij(" ",e.substring(e.indexOf(":")+1)," ")}}function C(e,t){if(1&e){const e=s.EpF();s.TgZ(0,"select",13),s.NdJ("ngModelChange",function(t){s.CHM(e);const i=s.oxw().$implicit;return s.oxw(3).data[i.id]=t})("change",function(){return s.CHM(e),s.oxw(4).setDirty()}),s.YNc(1,z,2,2,"option",14),s.qZA()}if(2&e){const e=s.oxw().$implicit,t=s.oxw(2).$implicit,i=s.oxw();s.hYB("id","",t.id,"-",e.id,""),s.Q6J("ngModel",i.data[e.id]),s.uIk("aria-describedby",t.id+"-"+e.id+"-help"),s.xp6(1),s.Q6J("ngForOf",e.defaultValues.split(","))}}function U(e,t){if(1&e){const e=s.EpF();s.TgZ(0,"textarea",13),s.NdJ("ngModelChange",function(t){s.CHM(e);const i=s.oxw().$implicit;return s.oxw(3).data[i.id]=t})("change",function(){return s.CHM(e),s.oxw(4).setDirty()}),s.qZA()}if(2&e){const e=s.oxw().$implicit,t=s.oxw(2).$implicit,i=s.oxw();s.hYB("id","",t.id,"-",e.id,""),s.Q6J("ngModel",i.data[e.id]),s.uIk("aria-describedby",t.id+"-"+e.id+"-help")}}function Y(e,t){if(1&e){const e=s.EpF();s.TgZ(0,"input",16),s.NdJ("ngModelChange",function(t){s.CHM(e);const i=s.oxw().$implicit;return s.oxw(3).data[i.id]=t})("change",function(){return s.CHM(e),s.oxw(4).setDirty()}),s.ALo(1,"formInputType"),s.qZA()}if(2&e){const e=s.oxw().$implicit,t=s.oxw(2).$implicit,i=s.oxw();s.hYB("id","",t.id,"-",e.id,""),s.Q6J("ngModel",i.data[e.id])("type",s.lcZ(1,5,e.dataType)),s.uIk("aria-describedby",t.id+"-"+e.id+"-help")}}function $(e,t){if(1&e&&(s.TgZ(0,"div",7),s.TgZ(1,"label",8),s._uU(2),s.qZA(),s.ynx(3,9),s.YNc(4,C,2,5,"select",10),s.YNc(5,U,1,4,"textarea",10),s.YNc(6,Y,2,7,"input",11),s.BQk(),s.TgZ(7,"small",12),s._uU(8),s.qZA(),s.qZA()),2&e){const e=t.$implicit,i=s.oxw(2).$implicit;s.xp6(1),s.hYB("for","",i.id,"-",e.id,""),s.xp6(1),s.Oqu(e.param),s.xp6(1),s.Q6J("ngSwitch",e.dataType),s.xp6(1),s.Q6J("ngSwitchCase","pickerinputrow"),s.xp6(1),s.Q6J("ngSwitchCase","textarearow"),s.xp6(2),s.hYB("id","",i.id,"-",e.id,"-help"),s.xp6(1),s.Oqu(e.hint)}}function j(e,t){if(1&e&&s.YNc(0,$,9,9,"div",6),2&e){const e=s.oxw().$implicit;s.Q6J("ngForOf",e.elements)}}function M(e,t){if(1&e&&(s.TgZ(0,"ngb-panel",4),s.YNc(1,j,1,1,"ng-template",5),s.qZA()),2&e){const e=t.$implicit;s.Q6J("id","s-"+e.id)("title",e.section)}}const L=function(){return[]};let D=(()=>{class e{constructor(e){this.formsService=e,this.data={},this.saved=new s.vpe,this.dirty=!1}ngOnInit(){this.type&&!this.schema&&this.formsService.loadSchema(this.type).subscribe(e=>{this.schema=e})}save(){this.saved.emit([this.schema,this.data]),this.dirty=!1}setDirty(){this.dirty=!0}canDeactivate(){return!this.dirty}}return e.\u0275fac=function(t){return new(t||e)(s.Y36(J))},e.\u0275cmp=s.Xpm({type:e,selectors:[["app-form"]],hostBindings:function(e,t){1&e&&s.NdJ("beforeunload",function(){return t.canDeactivate()},!1,s.Jf7)},inputs:{type:"type",schema:"schema",data:"data"},outputs:{saved:"saved"},decls:6,vars:2,consts:[["closeOthers","closeOthers"],["class","form",3,"id","title",4,"ngFor","ngForOf"],[1,"text-center","text-muted","mt-3","mb-5"],["type","button",1,"btn","btn-primary","btn-lg","btn-floating-action",3,"click"],[1,"form",3,"id","title"],["ngbPanelContent",""],["class","form-group",4,"ngFor","ngForOf"],[1,"form-group"],[3,"for"],[3,"ngSwitch"],["class","form-control",3,"ngModel","id","ngModelChange","change",4,"ngSwitchCase"],["class","form-control",3,"ngModel","type","id","ngModelChange","change",4,"ngSwitchDefault"],[1,"form-text","text-muted",3,"id"],[1,"form-control",3,"ngModel","id","ngModelChange","change"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"form-control",3,"ngModel","type","id","ngModelChange","change"]],template:function(e,t){1&e&&(s.TgZ(0,"ngb-accordion",0),s.YNc(1,M,2,2,"ngb-panel",1),s.qZA(),s.TgZ(2,"p",2),s._uU(3," Don't forget to save when you're done filling out the form!\n"),s.qZA(),s.TgZ(4,"button",3),s.NdJ("click",function(){return t.save()}),s._uU(5," Save\n"),s.qZA()),2&e&&(s.xp6(1),s.Q6J("ngForOf",(null==t.schema?null:t.schema.geminiForm)||s.DdM(1,L)))},directives:[r.gY,n.sg,r.Gk,r.gW,n.RF,n.n9,n.ED,a.EJ,a.JJ,a.On,a.YN,a.Kr,a.Fj],pipes:[_],styles:[""]}),e})(),Q=(()=>{class e{constructor(e,t){this.idService=e,this.auditService=t}create(e,t){const{id:i,mod:n}=this.idService.randomIdAndMod(),r=Object.assign({id:i,mod:n,usn:0,name:"",typeId:[]},t);return this.auditService.update(e,{[`zone.${i}`]:r},e=>(e.zone[i]=r,e)).pipe(m(r))}update(e,t,i){const n={};for(const[r,o]of Object.entries(i))n[`zone.${t}.${r}`]=o;return this.auditService.update(e,n,e=>(Object.assign(e.zone[t],i),e))}delete(e,{id:t,typeId:i}){const n={[`zone.${t}`]:{__op:"Delete"}};for(const r of i)n[`type.${r}`]={__op:"Delete"};return this.auditService.update(e,n,e=>{delete e.zone[t];for(const t of i)delete e.type[t];return e})}}return e.\u0275fac=function(t){return new(t||e)(s.LFG(Z),s.LFG(x))},e.\u0275prov=s.Yz7({token:e,factory:e.\u0275fac}),e})();const H=["*"];let P=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=s.Xpm({type:e,selectors:[["app-options-dropdown"]],inputs:{id:"id"},ngContentSelectors:H,decls:5,vars:2,consts:[["ngbDropdown","","placement","bottom-right","container","body",3,"click"],["ngbDropdownToggle","",1,"btn","btn-secondary","btn-sm",3,"id"],["ngbDropdownMenu",""]],template:function(e,t){1&e&&(s.F$t(),s.TgZ(0,"div",0),s.NdJ("click",function(e){return e.stopPropagation(),e.preventDefault()}),s.TgZ(1,"button",1),s._uU(2," Options "),s.qZA(),s.TgZ(3,"div",2),s.Hsn(4),s.qZA(),s.qZA()),2&e&&(s.xp6(1),s.MGl("id","actions-dropdown-",t.id,""),s.xp6(2),s.uIk("aria-labelledby","actions-dropdown-"+t.id))},directives:[r.jt,r.iD,r.Vi],styles:[""]}),e})();function E(e,t){if(1&e){const e=s.EpF();s.ynx(0),s._UZ(1,"div",8),s.TgZ(2,"button",9),s.NdJ("click",function(){s.CHM(e);const t=s.oxw().$implicit;return s.oxw().delete(t.value)}),s._uU(3,"Delete"),s.qZA(),s.BQk()}}const G=function(e){return[e]};function B(e,t){if(1&e){const e=s.EpF();s.TgZ(0,"a",3),s.TgZ(1,"div",4),s._uU(2),s.qZA(),s.TgZ(3,"app-options-dropdown",5),s.TgZ(4,"button",6),s.NdJ("click",function(){const t=s.CHM(e).$implicit;return s.oxw().rename(t.value)}),s._uU(5,"Rename"),s.qZA(),s.YNc(6,E,4,0,"ng-container",7),s.qZA(),s.qZA()}if(2&e){const e=t.$implicit,i=s.oxw();s.Q6J("routerLink",s.VKq(4,G,i.routerPrefix+e.value.id)),s.xp6(2),s.hij(" ",e.value.name," "),s.xp6(1),s.Q6J("id",e.value.id),s.xp6(3),s.Q6J("ngIf",void 0===i.audit.pendingChanges)}}let R=(()=>{class e{constructor(e,t,i){this.auditService=e,this.zoneService=t,this.featureService=i,this.routerPrefix=""}createZone(){const e=prompt("New Zone Name");e&&this.zoneService.create(this.audit,{name:e}).subscribe(e=>{this.audit.zone[e.id]=e})}rename(e){const t=prompt("Rename Zone",e.name);t&&this.zoneService.update(this.audit,e.id,{name:t}).subscribe(()=>{e.name=t})}delete(e){confirm(`Are you sure you want to delete '${e.name}'?`)&&(this.zoneService.delete(this.audit,e).subscribe(),this.featureService.deleteAll({zoneId:e.id.toString()}).subscribe())}}return e.\u0275fac=function(t){return new(t||e)(s.Y36(x),s.Y36(Q),s.Y36(F))},e.\u0275cmp=s.Xpm({type:e,selectors:[["app-zone-list"]],inputs:{audit:"audit",routerPrefix:"routerPrefix"},decls:5,vars:3,consts:[[1,"list-group","rounded-0"],[1,"list-group-item","list-group-item-action","text-success",3,"click"],["class","list-group-item list-group-item-action d-flex align-items-center","routerLinkActive","active",3,"routerLink",4,"ngFor","ngForOf"],["routerLinkActive","active",1,"list-group-item","list-group-item-action","d-flex","align-items-center",3,"routerLink"],[1,"flex-grow-1"],[1,"visible-hover",3,"id"],["ngbDropdownItem","",3,"click"],[4,"ngIf"],[1,"dropdown-divider"],["ngbDropdownItem","",1,"text-danger",3,"click"]],template:function(e,t){1&e&&(s.TgZ(0,"div",0),s.TgZ(1,"button",1),s.NdJ("click",function(){return t.createZone()}),s._uU(2," New Zone "),s.qZA(),s.YNc(3,B,7,6,"a",2),s.ALo(4,"keyvalue"),s.qZA()),2&e&&(s.xp6(3),s.Q6J("ngForOf",s.lcZ(4,1,t.audit.zone)))},directives:[n.sg,u.yS,u.Od,P,r.TH,n.O5],pipes:[n.Nd],styles:[""]}),e})();const X=["form"];function W(e,t){if(1&e){const e=s.EpF();s.TgZ(0,"app-form",10,11),s.NdJ("saved",function(t){return s.CHM(e),s.oxw(2).save(t[0],t[1])}),s.qZA()}if(2&e){const e=s.oxw(2);s.Q6J("data",e.data)}}function K(e,t){if(1&e&&(s.TgZ(0,"div",0),s.YNc(1,W,2,1,"app-form",9),s.qZA()),2&e){const e=s.oxw();s.xp6(1),s.Q6J("ngIf",e.selectedAudit)}}function V(e,t){if(1&e&&s._UZ(0,"app-zone-list",12),2&e){const e=s.oxw();s.Q6J("audit",e.selectedAudit)}}let ee=(()=>{class e{constructor(e,t,i){this.auditService=e,this.featureService=t,this.route=i,this.data={},this.activeTab="preaudit"}ngOnInit(){this.route.params.pipe((0,T.w)(({aid:e})=>(0,I.D)([this.auditService.findOne(e),this.featureService.findAll({auditId:e,belongsTo:"preaudit"})]))).subscribe(([e,t])=>{this.selectedAudit=e,this.feature=t[0],this.data=t[0]?this.featureService.feature2Data(t[0]):{}})}isSaved(){var e;return!(null===(e=this.form)||void 0===e?void 0:e.dirty)}save(e,t){if(this.feature){const i=this.featureService.data2Feature(e,t);return void this.featureService.update(this.feature,i).subscribe()}const{formId:i,values:n}=this.featureService.data2Feature(e,t);this.featureService.create({auditId:this.selectedAudit.auditId,belongsTo:"preaudit",mod:(new Date).valueOf().toString(),zoneId:null,typeId:null,usn:0,formId:i,values:n}).subscribe(e=>{this.feature=e})}}return e.\u0275fac=function(t){return new(t||e)(s.Y36(x),s.Y36(F),s.Y36(u.gz))},e.\u0275cmp=s.Xpm({type:e,selectors:[["app-audit"]],viewQuery:function(e,t){if(1&e&&s.Gf(X,5),2&e){let e;s.iGM(e=s.CRH())&&(t.form=e.first)}},decls:15,vars:3,consts:[[1,"container"],["routerLink","..",1,"bi-chevron-left","d-lg-none"],["ngbNav","",1,"nav-tabs",3,"activeId","activeIdChange"],["nav","ngbNav"],["ngbNavItem","preaudit"],["ngbNavLink",""],["ngbNavContent",""],["ngbNavItem","zone"],[1,"mt-2",3,"ngbNavOutlet"],["type","preaudit",3,"data","saved",4,"ngIf"],["type","preaudit",3,"data","saved"],["form",""],["routerPrefix","zones/",3,"audit"]],template:function(e,t){if(1&e&&(s.TgZ(0,"div",0),s.TgZ(1,"h1"),s._UZ(2,"a",1),s._uU(3),s.qZA(),s.TgZ(4,"ul",2,3),s.NdJ("activeIdChange",function(e){return t.activeTab=e}),s.TgZ(6,"li",4),s.TgZ(7,"a",5),s._uU(8,"Preaudit"),s.qZA(),s.YNc(9,K,2,1,"ng-template",6),s.qZA(),s.TgZ(10,"li",7),s.TgZ(11,"a",5),s._uU(12,"Zone"),s.qZA(),s.YNc(13,V,1,1,"ng-template",6),s.qZA(),s.qZA(),s._UZ(14,"div",8),s.qZA()),2&e){const e=s.MAs(5);s.xp6(3),s.hij(" ",null==t.selectedAudit?null:t.selectedAudit.name," "),s.xp6(1),s.Q6J("activeId",t.activeTab),s.xp6(10),s.Q6J("ngbNavOutlet",e)}},directives:[u.yS,r.Pz,r.nv,r.Vx,r.uN,r.tO,n.O5,D,R],styles:[""]}),e})();const te=[[["","breadcrumb",""]],[["","list",""]]],ie=function(){return{exact:!0}},ne=["[breadcrumb]","[list]"];let re=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=s.Xpm({type:e,selectors:[["app-master-detail"]],ngContentSelectors:ne,decls:7,vars:2,consts:[[1,"row","no-gutters","h-100"],["routerLinkActive","master-active",1,"col-lg-3","h-100","overflow-auto","master",3,"routerLinkActiveOptions"],["routerLink",".",1,"d-none"],[1,"col-lg-9","h-100","overflow-auto","detail"]],template:function(e,t){1&e&&(s.F$t(te),s.TgZ(0,"div",0),s.TgZ(1,"div",1),s._UZ(2,"a",2),s.Hsn(3),s.Hsn(4,1),s.qZA(),s.TgZ(5,"div",3),s._UZ(6,"router-outlet"),s.qZA(),s.qZA()),2&e&&(s.xp6(1),s.Q6J("routerLinkActiveOptions",s.DdM(1,ie)))},directives:[u.Od,u.yS,u.lC],styles:["@media (max-width: 991px){.master-active[_ngcontent-%COMP%] + .detail[_ngcontent-%COMP%], .master[_ngcontent-%COMP%]:not(.master-active){display:none!important}}"]}),e})();function oe(e,t){1&e&&s._UZ(0,"i",15)}function ae(e,t){}function se(e,t){if(1&e){const e=s.EpF();s.TgZ(0,"button",10),s.NdJ("click",function(){s.CHM(e);const t=s.oxw().$implicit;return s.oxw().download(t)}),s._uU(1," Download Offline Copy "),s.qZA(),s._UZ(2,"div",11),s.TgZ(3,"button",16),s.NdJ("click",function(){s.CHM(e);const t=s.oxw().$implicit;return s.oxw().delete(t)}),s._uU(4,"Delete"),s.qZA()}}function ce(e,t){if(1&e){const e=s.EpF();s.TgZ(0,"button",22),s.NdJ("click",function(){s.CHM(e);const t=s.oxw(2).$implicit;return s.oxw().upload(t)}),s._uU(1," Upload "),s.qZA()}}function ue(e,t){if(1&e){const e=s.EpF();s.TgZ(0,"button",16),s.NdJ("click",function(){s.CHM(e);const t=s.oxw(2).$implicit;return s.oxw().download(t)}),s._uU(1," Discard "),s.qZA()}}function de(e,t){if(1&e){const e=s.EpF();s.TgZ(0,"div",17),s._UZ(1,"i",18),s._uU(2," Pending Changes "),s.TgZ(3,"span",19),s._uU(4),s.qZA(),s.qZA(),s.YNc(5,ce,2,0,"button",20),s.YNc(6,ue,2,0,"button",21),s.TgZ(7,"button",16),s.NdJ("click",function(){s.CHM(e);const t=s.oxw().$implicit;return s.oxw().deleteOffline(t)}),s._uU(8," Remove Offline Copy "),s.qZA()}if(2&e){const e=s.oxw().$implicit;s.xp6(4),s.Oqu(e.pendingChanges),s.xp6(1),s.Q6J("ngIf",e.pendingChanges),s.xp6(1),s.Q6J("ngIf",e.pendingChanges)}}const le=function(e){return[e]};function pe(e,t){if(1&e){const e=s.EpF();s.TgZ(0,"a",6),s.TgZ(1,"div",7),s._uU(2),s.YNc(3,oe,1,0,"i",8),s.qZA(),s.TgZ(4,"app-options-dropdown",9),s.TgZ(5,"button",10),s.NdJ("click",function(){const t=s.CHM(e).$implicit;return s.oxw().rename(t)}),s._uU(6,"Rename"),s.qZA(),s._UZ(7,"div",11),s.YNc(8,ae,0,0,"ng-template",12),s.YNc(9,se,5,0,"ng-template",null,13,s.W1O),s.YNc(11,de,9,3,"ng-template",null,14,s.W1O),s.qZA(),s.qZA()}if(2&e){const e=t.$implicit,i=s.MAs(10),n=s.MAs(12);s.Q6J("routerLink",s.VKq(7,le,e.auditId)),s.xp6(2),s.hij(" ",e.name," "),s.xp6(1),s.Q6J("ngIf",void 0!==e.pendingChanges),s.xp6(1),s.Q6J("id",e.auditId),s.xp6(4),s.Q6J("ngIf",void 0===e.pendingChanges)("ngIfThen",i)("ngIfElse",n)}}let fe=(()=>{class e{constructor(e,t,i){this.auditService=e,this.offlineAuditService=t,this.featureService=i,this.audits=[]}ngOnInit(){this.auditService.findAll().subscribe(e=>{this.audits=e})}create(){const e=prompt("New Audit Name");e&&this.auditService.create({name:e,type:{},zone:{}}).subscribe(e=>{this.audits.push(e)})}rename(e){const t=prompt("Rename Audit",e.name);t&&this.auditService.update(e,{name:t},e=>(e.name=t,e)).subscribe()}delete(e){confirm(`Are you sure you want to delete '${e.name}'?`)&&(this.auditService.delete(e).subscribe(()=>{const t=this.audits.indexOf(e);t>=0&&this.audits.splice(t,1)}),this.featureService.deleteAll({auditId:e.auditId}).subscribe())}download(e){e.pendingChanges&&!confirm(`Are you sure you want to discard ${e.pendingChanges} pending changes? This cannot be undone.`)||(this.offlineAuditService.save(e),this.featureService.saveAll({auditId:e.auditId}))}upload(e){this.auditService.upload(e).subscribe(),this.featureService.upload({auditId:e.auditId}).subscribe()}deleteOffline(e){confirm("Are you sure you want to discard the offline copy"+(e.pendingChanges?", including "+e.pendingChanges+" pending changes? This cannot be undone.":"? This can be undone once an internet connection is available."))&&this.offlineAuditService.delete(e)}}return e.\u0275fac=function(t){return new(t||e)(s.Y36(x),s.Y36(y),s.Y36(F))},e.\u0275cmp=s.Xpm({type:e,selectors:[["app-pre-audit"]],decls:9,vars:1,consts:[["breadcrumb","","aria-label","breadcrumb"],[1,"breadcrumb"],["aria-current","page",1,"breadcrumb-item","active"],["list","",1,"list-group","rounded-0"],[1,"list-group-item","list-group-item-action","text-success",3,"click"],["class","list-group-item list-group-item-action d-flex align-items-center","routerLinkActive","active text-white",3,"routerLink",4,"ngFor","ngForOf"],["routerLinkActive","active text-white",1,"list-group-item","list-group-item-action","d-flex","align-items-center",3,"routerLink"],[1,"flex-grow-1"],["class","bi-wifi-off","ngbTooltip","Available Offline",4,"ngIf"],[1,"visible-hover",3,"id"],["ngbDropdownItem","",3,"click"],[1,"dropdown-divider"],[3,"ngIf","ngIfThen","ngIfElse"],["onlineOptions",""],["offlineOptions",""],["ngbTooltip","Available Offline",1,"bi-wifi-off"],["ngbDropdownItem","",1,"text-danger",3,"click"],[1,"dropdown-header"],[1,"bi-wifi-off"],[1,"badge","badge-primary"],["ngbDropdownItem","","class","text-success",3,"click",4,"ngIf"],["ngbDropdownItem","","class","text-danger",3,"click",4,"ngIf"],["ngbDropdownItem","",1,"text-success",3,"click"]],template:function(e,t){1&e&&(s.TgZ(0,"app-master-detail"),s.TgZ(1,"nav",0),s.TgZ(2,"ol",1),s.TgZ(3,"li",2),s._uU(4,"Audits"),s.qZA(),s.qZA(),s.qZA(),s.TgZ(5,"div",3),s.TgZ(6,"button",4),s.NdJ("click",function(){return t.create()}),s._uU(7," New Audit "),s.qZA(),s.YNc(8,pe,13,9,"a",5),s.qZA(),s.qZA()),2&e&&(s.xp6(8),s.Q6J("ngForOf",t.audits))},directives:[re,n.sg,u.yS,u.Od,n.O5,P,r.TH,r._L],styles:[""]}),e})();const ge=[{id:"plugload",name:"Plugload",subTypes:[{id:"combination_oven",name:"Combination Oven"},{id:"convection_oven",name:"Convection Oven"},{id:"conveyor_oven",name:"Conveyor Oven"},{id:"fryer",name:"Fryer"},{id:"icemaker",name:"Ice Maker"},{id:"rack_oven",name:"Rack Oven"},{id:"steam_cooker",name:"Steam Cooker"},{id:"griddle",name:"Griddle"},{id:"hot_food_cabinet",name:"Hot Food Cabinet"},{id:"conveyor_broiler",name:"Conveyor Broiler"},{id:"dishwasher",name:"Dish Washer"},{id:"pre_rinse_spray",name:"Pre Rinse Spray"},{id:"sample_appliance",name:"Sample Appliance"}]},{id:"hvac",name:"HVAC"},{id:"hotwater",name:"WaterHeater"},{id:"refrigeration",name:"Refrigeration",subTypes:[{id:"walkin_refrigerator",name:"Walk-In Refrigerator"},{id:"walkin_freezer",name:"Walk-In Freezer"},{id:"refrigerator",name:"Refrigerator"},{id:"freezer",name:"Freezer"},{id:"walkin_coolbot",name:"Walk-In Cooler Box"}]},{id:"lighting",name:"Lighting",subTypes:[{id:"halogen",name:"Halogen"},{id:"cfl",name:"CFL"},{id:"linearfluorescent",name:"Linear Fluorescent"},{id:"incandescent",name:"Incandescent"},{id:"hpsodium",name:"High Pressure Sodium"},{id:"lpsodium",name:"Low Pressure Sodium"}]},{id:"motors",name:"Motors"},{id:"others",name:"Others"}];let me=(()=>{class e{constructor(e,t){this.idService=e,this.auditService=t}create(e,t,i){const{id:n,mod:r}=this.idService.randomIdAndMod(),o=Object.assign({id:n,mod:r,usn:0,zoneId:t.id},i);return this.auditService.update(e,{[`type.${n}`]:o,[`zone.${t.id}.typeId`]:{__op:"AddUnique",objects:[n]}},e=>(e.type[n]=o,t.typeId.push(n),e)).pipe(m(o))}update(e,t,i){const n={};for(const[r,o]of Object.entries(i))n[`type.${t}.${r}`]=o;return this.auditService.update(e,n,e=>(Object.assign(e.type[t],i),e))}delete(e,t,i){return this.auditService.update(e,{[`type.${i}`]:{__op:"Delete"},[`zone.${t}.typeId`]:{__op:"Remove",objects:[i]}},e=>{delete e.type[i];const n=e.zone[t],r=n.typeId.indexOf(i);return r>=0&&n.typeId.splice(r,1),e})}}return e.\u0275fac=function(t){return new(t||e)(s.LFG(Z),s.LFG(x))},e.\u0275prov=s.Yz7({token:e,factory:e.\u0275fac}),e})();function he(e,t){if(1&e){const e=s.EpF();s.TgZ(0,"button",4),s.NdJ("click",function(){s.CHM(e);const t=s.oxw();return t.createType(t.type)}),s._uU(1),s.qZA()}if(2&e){const e=s.oxw();s.xp6(1),s.hij(" New ",e.type.name," ")}}function ve(e,t){if(1&e){const e=s.EpF();s.TgZ(0,"button",7),s.NdJ("click",function(){const t=s.CHM(e).$implicit,i=s.oxw(2);return i.createType(i.type,t)}),s._uU(1),s.qZA()}if(2&e){const e=t.$implicit;s.xp6(1),s.hij(" ",e.name," ")}}function be(e,t){if(1&e&&(s.TgZ(0,"details",5),s.TgZ(1,"summary"),s._uU(2,"New"),s.qZA(),s.YNc(3,ve,2,1,"button",6),s.qZA()),2&e){const e=s.oxw();s.xp6(3),s.Q6J("ngForOf",e.type.subTypes)}}function ye(e,t){if(1&e){const e=s.EpF();s.ynx(0),s._UZ(1,"div",14),s.TgZ(2,"button",15),s.NdJ("click",function(){s.CHM(e);const t=s.oxw().$implicit;return s.oxw().delete(t)}),s._uU(3,"Delete"),s.qZA(),s.BQk()}}const Ze=function(e){return[e]};function Ae(e,t){if(1&e){const e=s.EpF();s.TgZ(0,"a",8),s.TgZ(1,"div",9),s._uU(2),s.TgZ(3,"small",10),s._uU(4),s.qZA(),s.qZA(),s.TgZ(5,"app-options-dropdown",11),s.TgZ(6,"button",12),s.NdJ("click",function(){const t=s.CHM(e).$implicit;return s.oxw().rename(t)}),s._uU(7,"Rename"),s.qZA(),s.YNc(8,ye,4,0,"ng-container",13),s.qZA(),s.qZA()}if(2&e){const e=t.$implicit,i=s.oxw();s.Q6J("routerLink",s.VKq(5,Ze,i.routerPrefix+e.id)),s.xp6(2),s.hij(" ",e.name," "),s.xp6(2),s.Oqu(e.subtype),s.xp6(1),s.Q6J("id",e.id),s.xp6(3),s.Q6J("ngIf",void 0===i.audit.pendingChanges)}}let Se=(()=>{class e{constructor(e,t,i){this.auditService=e,this.typeService=t,this.featureService=i,this.routerPrefix=""}createType(e,t){var i,n;const r=prompt(`New ${null!==(i=null==t?void 0:t.name)&&void 0!==i?i:e.name} Name`);r&&this.typeService.create(this.audit,this.zone,{type:e.name,subtype:null!==(n=null==t?void 0:t.name)&&void 0!==n?n:null,name:r}).subscribe(e=>{this.types.push(e)})}rename(e){const t=prompt("Rename Type",e.name);t&&this.typeService.update(this.audit,e.id,{name:t}).subscribe()}delete(e){confirm(`Are you sure you want to delete '${e.name}'?`)&&(this.typeService.delete(this.audit,e.zoneId,e.id).subscribe(()=>{const t=this.types.indexOf(e);t>=0&&this.types.splice(t,1)}),this.featureService.deleteAll({typeId:e.id.toString()}).subscribe())}}return e.\u0275fac=function(t){return new(t||e)(s.Y36(x),s.Y36(me),s.Y36(F))},e.\u0275cmp=s.Xpm({type:e,selectors:[["app-type-list"]],inputs:{audit:"audit",zone:"zone",types:"types",type:"type",routerPrefix:"routerPrefix"},decls:4,vars:3,consts:[[1,"list-group","rounded-0"],["class","list-group-item list-group-item-action text-success",3,"click",4,"ngIf"],["class","list-group-item text-success",4,"ngIf"],["class","list-group-item list-group-item-action d-flex align-items-center","routerLinkActive","active text-white",3,"routerLink",4,"ngFor","ngForOf"],[1,"list-group-item","list-group-item-action","text-success",3,"click"],[1,"list-group-item","text-success"],["class","btn btn-sm btn-link text-success",3,"click",4,"ngFor","ngForOf"],[1,"btn","btn-sm","btn-link","text-success",3,"click"],["routerLinkActive","active text-white",1,"list-group-item","list-group-item-action","d-flex","align-items-center",3,"routerLink"],[1,"flex-grow-1"],[1,"text-muted"],[1,"visible-hover",3,"id"],["ngbDropdownItem","",3,"click"],[4,"ngIf"],[1,"dropdown-divider"],["ngbDropdownItem","",1,"text-danger",3,"click"]],template:function(e,t){1&e&&(s.TgZ(0,"div",0),s.YNc(1,he,2,1,"button",1),s.YNc(2,be,4,1,"details",2),s.YNc(3,Ae,9,7,"a",3),s.qZA()),2&e&&(s.xp6(1),s.Q6J("ngIf",!t.type.subTypes),s.xp6(1),s.Q6J("ngIf",t.type.subTypes),s.xp6(1),s.Q6J("ngForOf",t.types))},directives:[n.O5,n.sg,u.yS,u.Od,P,r.TH],styles:[""]}),e})();function xe(e,t){if(1&e&&s._UZ(0,"app-type-list",9),2&e){const e=s.oxw();s.Q6J("audit",e.audit)("zone",e.zone)("types",e.types)("type",e.type)}}let we=(()=>{class e{constructor(e,t){this.route=e,this.auditService=t,this.types=[]}ngOnInit(){this.route.params.pipe((0,T.w)(({aid:e,zid:t,type:i})=>this.auditService.findOne(e).pipe((0,b.b)(e=>{this.type=ge.find(e=>e.name===i),this.audit=e,this.zone=e.zone[t],this.types=Object.values(e.type).filter(e=>e.type===i&&e.zoneId==t)})))).subscribe()}}return e.\u0275fac=function(t){return new(t||e)(s.Y36(u.gz),s.Y36(x))},e.\u0275cmp=s.Xpm({type:e,selectors:[["app-pre-type"]],decls:18,vars:4,consts:[["breadcrumb","","aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item"],["routerLink","../../../.."],["routerLink","../../.."],["routerLink","../.."],["routerLink",".."],["aria-current","page",1,"breadcrumb-item","active"],["list","",3,"audit","zone","types","type",4,"ngIf"],["list","",3,"audit","zone","types","type"]],template:function(e,t){1&e&&(s.TgZ(0,"app-master-detail"),s.TgZ(1,"nav",0),s.TgZ(2,"ol",1),s.TgZ(3,"li",2),s.TgZ(4,"a",3),s._uU(5,"Audits"),s.qZA(),s.qZA(),s.TgZ(6,"li",2),s.TgZ(7,"a",4),s._uU(8),s.qZA(),s.qZA(),s.TgZ(9,"li",2),s.TgZ(10,"a",5),s._uU(11,"Zones"),s.qZA(),s.qZA(),s.TgZ(12,"li",2),s.TgZ(13,"a",6),s._uU(14),s.qZA(),s.qZA(),s.TgZ(15,"li",7),s._uU(16),s.qZA(),s.qZA(),s.qZA(),s.YNc(17,xe,1,4,"app-type-list",8),s.qZA()),2&e&&(s.xp6(8),s.Oqu(null==t.audit?null:t.audit.name),s.xp6(6),s.Oqu(null==t.zone?null:t.zone.name),s.xp6(2),s.Oqu(null==t.type?null:t.type.name),s.xp6(1),s.Q6J("ngIf",t.type&&t.audit&&t.zone&&t.types))},directives:[re,u.yS,n.O5,Se],styles:[""]}),e})();function Ie(e,t){if(1&e&&s._UZ(0,"app-zone-list",7),2&e){const e=s.oxw();s.Q6J("audit",e.audit)}}let Te=(()=>{class e{constructor(e,t){this.route=e,this.auditService=t}ngOnInit(){this.route.params.pipe((0,T.w)(({aid:e})=>this.auditService.findOne(e))).subscribe(e=>{this.audit=e})}}return e.\u0275fac=function(t){return new(t||e)(s.Y36(u.gz),s.Y36(x))},e.\u0275cmp=s.Xpm({type:e,selectors:[["app-pre-zone"]],decls:12,vars:2,consts:[["breadcrumb","","aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item"],["routerLink","../.."],["routerLink",".."],["aria-current","page",1,"breadcrumb-item","active"],["list","",3,"audit",4,"ngIf"],["list","",3,"audit"]],template:function(e,t){1&e&&(s.TgZ(0,"app-master-detail"),s.TgZ(1,"nav",0),s.TgZ(2,"ol",1),s.TgZ(3,"li",2),s.TgZ(4,"a",3),s._uU(5,"Audits"),s.qZA(),s.qZA(),s.TgZ(6,"li",2),s.TgZ(7,"a",4),s._uU(8),s.qZA(),s.qZA(),s.TgZ(9,"li",5),s._uU(10,"Zones"),s.qZA(),s.qZA(),s.qZA(),s.YNc(11,Ie,1,1,"app-zone-list",6),s.qZA()),2&e&&(s.xp6(8),s.Oqu(null==t.audit?null:t.audit.name),s.xp6(3),s.Q6J("ngIf",t.audit))},directives:[re,u.yS,n.O5,R],styles:[""]}),e})();const Oe=["form"];function ke(e,t){if(1&e){const e=s.EpF();s.TgZ(0,"app-form",4,5),s.NdJ("saved",function(){s.CHM(e);const t=s.oxw();return t.save(t.data)}),s.qZA()}if(2&e){const e=s.oxw();s.Q6J("data",e.data)("type",e.schemaId)}}let qe=(()=>{class e{constructor(e,t,i){this.auditService=e,this.featureService=t,this.route=i}ngOnInit(){this.route.params.pipe((0,T.w)(({aid:e,zid:t,tid:i})=>(0,I.D)([this.auditService.findOne(e).pipe((0,f.U)(e=>e.type[i])),this.featureService.findAll({auditId:e,zoneId:t,typeId:i})]))).subscribe(([e,t])=>{this.type=e;const i=ge.find(t=>t.name===e.type),n=e.subtype?i.subTypes.find(t=>t.name===e.subtype):i;this.schemaId=n.id,this.feature=t[0],this.data=this.feature?this.featureService.feature2Data(this.feature):{}})}isSaved(){var e;return!(null===(e=this.form)||void 0===e?void 0:e.dirty)}save(e,t){if(this.feature){const i=this.featureService.data2Feature(e,t);return void this.featureService.update(this.feature,i).subscribe()}const{formId:i,values:n}=this.featureService.data2Feature(e,t),{aid:r,zid:o,tid:a}=this.route.snapshot.params;this.featureService.create({auditId:r,zoneId:o,typeId:a,belongsTo:"type",mod:(new Date).valueOf().toString(),usn:0,formId:i,values:n}).subscribe(e=>{this.feature=e})}}return e.\u0275fac=function(t){return new(t||e)(s.Y36(x),s.Y36(F),s.Y36(u.gz))},e.\u0275cmp=s.Xpm({type:e,selectors:[["app-type"]],viewQuery:function(e,t){if(1&e&&s.Gf(Oe,5),2&e){let e;s.iGM(e=s.CRH())&&(t.form=e.first)}},decls:7,vars:3,consts:[[1,"container"],["routerLink","..",1,"bi-chevron-left","d-lg-none"],[1,"text-muted","small"],[3,"data","type","saved",4,"ngIf"],[3,"data","type","saved"],["form",""]],template:function(e,t){1&e&&(s.TgZ(0,"div",0),s.TgZ(1,"h1"),s._UZ(2,"a",1),s._uU(3),s.TgZ(4,"span",2),s._uU(5),s.qZA(),s.qZA(),s.YNc(6,ke,2,2,"app-form",3),s.qZA()),2&e&&(s.xp6(3),s.hij(" ",null==t.type?null:t.type.name," "),s.xp6(2),s.hij(" ",null==t.type?null:t.type.subtype," "),s.xp6(1),s.Q6J("ngIf",t.data))},directives:[u.yS,n.O5,D],styles:[""]}),e})();function Ne(e,t){if(1&e&&s._UZ(0,"app-type-list",9),2&e){const e=s.oxw().$implicit,t=s.oxw();s.Q6J("types",t.groupedTypes[e.name])("audit",t.audit)("zone",t.selectedZone)("type",e)("routerPrefix",e.name+"/")}}function Fe(e,t){if(1&e&&(s.TgZ(0,"li",6),s.TgZ(1,"a",7),s._uU(2),s.qZA(),s.YNc(3,Ne,1,5,"ng-template",8),s.qZA()),2&e){const e=t.$implicit;s.Q6J("ngbNavItem",e.name),s.xp6(2),s.Oqu(e.name)}}const Je=[{path:"",component:fe,children:[{path:":aid",component:ee,canDeactivate:[w]}]},{path:":aid/zones",component:Te,children:[{path:":zid",component:(()=>{class e{constructor(e,t){this.auditService=e,this.route=t,this.types=ge,this.groupedTypes={};for(const i of ge)this.groupedTypes[i.name]=[]}ngOnInit(){this.route.params.pipe((0,T.w)(({aid:e,zid:t})=>this.auditService.findOne(e).pipe((0,b.b)(e=>this.audit=e),(0,f.U)(e=>e.zone[t])))).subscribe(e=>{var t,i;this.selectedZone=e;const n=null!==(i=null===(t=this.selectedZone)||void 0===t?void 0:t.typeId.map(e=>this.audit.type[e]))&&void 0!==i?i:[];for(const r of n)this.groupedTypes[r.type].push(r)})}}return e.\u0275fac=function(t){return new(t||e)(s.Y36(x),s.Y36(u.gz))},e.\u0275cmp=s.Xpm({type:e,selectors:[["app-zone"]],decls:8,vars:4,consts:[[1,"container"],["routerLink","..",1,"bi-chevron-left","d-lg-none"],["ngbNav","",1,"nav-tabs",3,"activeId","activeIdChange"],["nav","ngbNav"],[3,"ngbNavItem",4,"ngFor","ngForOf"],[1,"mt-2",3,"ngbNavOutlet"],[3,"ngbNavItem"],["ngbNavLink",""],["ngbNavContent",""],[3,"types","audit","zone","type","routerPrefix"]],template:function(e,t){if(1&e&&(s.TgZ(0,"div",0),s.TgZ(1,"h1"),s._UZ(2,"a",1),s._uU(3),s.qZA(),s.TgZ(4,"ul",2,3),s.NdJ("activeIdChange",function(e){return t.activeTab=e}),s.YNc(6,Fe,4,2,"li",4),s.qZA(),s._UZ(7,"div",5),s.qZA()),2&e){const e=s.MAs(5);s.xp6(3),s.hij(" ",null==t.selectedZone?null:t.selectedZone.name," "),s.xp6(1),s.Q6J("activeId",t.activeTab),s.xp6(2),s.Q6J("ngForOf",t.types),s.xp6(1),s.Q6J("ngbNavOutlet",e)}},directives:[u.yS,r.Pz,n.sg,r.tO,r.nv,r.Vx,r.uN,Se],styles:[""]}),e})()}]},{path:":aid/zones/:zid/:type",component:we,children:[{path:":tid",component:qe,canDeactivate:[w]}]}];let _e=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=s.oAB({type:e}),e.\u0275inj=s.cJS({imports:[[u.Bz.forChild(Je)],u.Bz]}),e})(),ze=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=s.oAB({type:e}),e.\u0275inj=s.cJS({providers:[Z,x,y,S,Q,me,F,q,k],imports:[[n.ez,d,c,r.Oz,r.XC,_e,r.HK]]}),e})()}}]);