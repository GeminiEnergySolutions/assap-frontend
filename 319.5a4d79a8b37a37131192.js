(self.webpackChunkconserve=self.webpackChunkconserve||[]).push([[319],{3319:(e,t,i)=>{"use strict";i.r(t),i.d(t,{AuditsModule:()=>ve});var n=i(535),r=i(6175),a=i(7602),o=i(4731),s=i(60);let c=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=s.oAB({type:e}),e.\u0275inj=s.cJS({imports:[[n.ez,a.JF,o.u5,r.Gs]]}),e})();var u=i(4752);let d=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=s.oAB({type:e}),e.\u0275inj=s.cJS({imports:[[n.ez,u.Bz,r.XC]]}),e})();var p=i(385),l=i(628);let m=(()=>{class e{constructor(e){this.parseService=e}randomIdAndMod(){const e=(new Date).valueOf();return{id:e/1e3|0,mod:e}}findAll(e={}){return this.parseService.findAll("rAudit",e).pipe((0,p.U)(e=>this.merge(e)))}merge(e){const t=new Map;for(const i of e){const e=t.get(i.auditId);e?e.updatedAt<i.updatedAt?(e.name=i.name,e.type=Object.assign(Object.assign({},e.type),i.type),e.zone=Object.assign(Object.assign({},e.zone),i.zone)):(e.type=Object.assign(Object.assign({},i.type),e.type),e.zone=Object.assign(Object.assign({},i.zone),e.zone)):t.set(i.auditId,i)}return[...t.values()]}create(e){const{id:t,mod:i}=this.randomIdAndMod(),n=Object.assign({auditId:t.toString(),mod:i.toString(),usn:0},e);return this.parseService.create("rAudit",n)}update(e,t){return this.parseService.update("rAudit",e,t)}delete({objectId:e}){return this.parseService.delete("rAudit",e)}}return e.\u0275fac=function(t){return new(t||e)(s.LFG(l.X))},e.\u0275prov=s.Yz7({token:e,factory:e.\u0275fac}),e})(),f=(()=>{class e{canDeactivate(e){return e.isSaved()||confirm("Are you sure you want to leave this page? Changes that you made may not be saved.")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=s.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var g=i(3126),h=i(4722);let v=(()=>{class e{constructor(e){this.parseService=e}findAll(e={},t){return this.parseService.findAll("rFeature",e,t)}create(e){return this.parseService.create("rFeature",e)}update(e,t){return this.parseService.update("rFeature",e,t)}delete(e){return this.parseService.delete("rFeature",e)}deleteAll(e={}){return this.findAll(e,["objectId"]).pipe((0,h.w)(e=>{const t=e.map(e=>({method:"DELETE",path:"/parse/classes/rFeature/"+e.objectId}));return this.parseService.batch(t)}))}feature2Data(e){const t={},i=e.formId.split("\x1f"),n=e.values.split("\x1f"),r=Math.min(i.length,n.length);for(let a=0;a<r;a++)t[i[a]]=n[a];return t}data2Feature(e){const t=Object.entries(e);return{formId:t.map(e=>e[0]).join("\x1f"),values:t.map(e=>e[1]).join("\x1f")}}}return e.\u0275fac=function(t){return new(t||e)(s.LFG(l.X))},e.\u0275prov=s.Yz7({token:e,factory:e.\u0275fac}),e})(),b=(()=>{class e{constructor(e){this.http=e}loadSchema(e){return this.http.get(`/assets/${e}.json`)}}return e.\u0275fac=function(t){return new(t||e)(s.LFG(a.eN))},e.\u0275prov=s.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),y=(()=>{class e{transform(t){return e.mapping[t]||"text"}}return e.mapping={emailrow:"email",phonerow:"tel",introw:"number",decimalrow:"number"},e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=s.Yjl({name:"formInputType",type:e,pure:!0}),e})();function Z(e,t){if(1&e&&(s.TgZ(0,"option",15),s._uU(1),s.qZA()),2&e){const e=t.$implicit;s.Q6J("value",e.substring(e.indexOf(":")+1)),s.xp6(1),s.hij(" ",e.substring(e.indexOf(":")+1)," ")}}function x(e,t){if(1&e){const e=s.EpF();s.TgZ(0,"select",13),s.NdJ("ngModelChange",function(t){s.CHM(e);const i=s.oxw().$implicit;return s.oxw(3).data[i.id]=t})("change",function(){return s.CHM(e),s.oxw(4).setDirty()}),s.YNc(1,Z,2,2,"option",14),s.qZA()}if(2&e){const e=s.oxw().$implicit,t=s.oxw(2).$implicit,i=s.oxw();s.hYB("id","",t.id,"-",e.id,""),s.Q6J("ngModel",i.data[e.id]),s.uIk("aria-describedby",t.id+"-"+e.id+"-help"),s.xp6(1),s.Q6J("ngForOf",e.defaultValues.split(","))}}function A(e,t){if(1&e){const e=s.EpF();s.TgZ(0,"textarea",13),s.NdJ("ngModelChange",function(t){s.CHM(e);const i=s.oxw().$implicit;return s.oxw(3).data[i.id]=t})("change",function(){return s.CHM(e),s.oxw(4).setDirty()}),s.qZA()}if(2&e){const e=s.oxw().$implicit,t=s.oxw(2).$implicit,i=s.oxw();s.hYB("id","",t.id,"-",e.id,""),s.Q6J("ngModel",i.data[e.id]),s.uIk("aria-describedby",t.id+"-"+e.id+"-help")}}function w(e,t){if(1&e){const e=s.EpF();s.TgZ(0,"input",16),s.NdJ("ngModelChange",function(t){s.CHM(e);const i=s.oxw().$implicit;return s.oxw(3).data[i.id]=t})("change",function(){return s.CHM(e),s.oxw(4).setDirty()}),s.ALo(1,"formInputType"),s.qZA()}if(2&e){const e=s.oxw().$implicit,t=s.oxw(2).$implicit,i=s.oxw();s.hYB("id","",t.id,"-",e.id,""),s.Q6J("ngModel",i.data[e.id])("type",s.lcZ(1,5,e.dataType)),s.uIk("aria-describedby",t.id+"-"+e.id+"-help")}}function T(e,t){if(1&e&&(s.TgZ(0,"div",7),s.TgZ(1,"label",8),s._uU(2),s.qZA(),s.ynx(3,9),s.YNc(4,x,2,5,"select",10),s.YNc(5,A,1,4,"textarea",10),s.YNc(6,w,2,7,"input",11),s.BQk(),s.TgZ(7,"small",12),s._uU(8),s.qZA(),s.qZA()),2&e){const e=t.$implicit,i=s.oxw(2).$implicit;s.xp6(1),s.hYB("for","",i.id,"-",e.id,""),s.xp6(1),s.Oqu(e.param),s.xp6(1),s.Q6J("ngSwitch",e.dataType),s.xp6(1),s.Q6J("ngSwitchCase","pickerinputrow"),s.xp6(1),s.Q6J("ngSwitchCase","textarearow"),s.xp6(2),s.hYB("id","",i.id,"-",e.id,"-help"),s.xp6(1),s.Oqu(e.hint)}}function I(e,t){if(1&e&&s.YNc(0,T,9,9,"div",6),2&e){const e=s.oxw().$implicit;s.Q6J("ngForOf",e.elements)}}function S(e,t){if(1&e&&(s.TgZ(0,"ngb-panel",4),s.YNc(1,I,1,1,"ng-template",5),s.qZA()),2&e){const e=t.$implicit;s.Q6J("id","s-"+e.id)("title",e.section)}}const q=function(){return[]};let k=(()=>{class e{constructor(e){this.formsService=e,this.data={},this.dataChanged=new s.vpe,this.dirty=!1}ngOnInit(){this.type&&!this.schema&&this.formsService.loadSchema(this.type).subscribe(e=>{this.schema=e})}save(){this.dataChanged.emit(this.data),this.dirty=!1}setDirty(){this.dirty=!0}canDeactivate(){return!this.dirty}}return e.\u0275fac=function(t){return new(t||e)(s.Y36(b))},e.\u0275cmp=s.Xpm({type:e,selectors:[["app-form"]],hostBindings:function(e,t){1&e&&s.NdJ("beforeunload",function(){return t.canDeactivate()},!1,s.Jf7)},inputs:{type:"type",schema:"schema",data:"data"},outputs:{dataChanged:"dataChanged"},decls:6,vars:2,consts:[["closeOthers","closeOthers"],["class","form",3,"id","title",4,"ngFor","ngForOf"],[1,"text-center","text-muted","mt-3","mb-5"],["type","button",1,"btn","btn-primary","btn-lg","btn-floating-action",3,"click"],[1,"form",3,"id","title"],["ngbPanelContent",""],["class","form-group",4,"ngFor","ngForOf"],[1,"form-group"],[3,"for"],[3,"ngSwitch"],["class","form-control",3,"ngModel","id","ngModelChange","change",4,"ngSwitchCase"],["class","form-control",3,"ngModel","type","id","ngModelChange","change",4,"ngSwitchDefault"],[1,"form-text","text-muted",3,"id"],[1,"form-control",3,"ngModel","id","ngModelChange","change"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"form-control",3,"ngModel","type","id","ngModelChange","change"]],template:function(e,t){1&e&&(s.TgZ(0,"ngb-accordion",0),s.YNc(1,S,2,2,"ngb-panel",1),s.qZA(),s.TgZ(2,"p",2),s._uU(3," Don't forget to save when you're done filling out the form!\n"),s.qZA(),s.TgZ(4,"button",3),s.NdJ("click",function(){return t.save()}),s._uU(5," Save\n"),s.qZA()),2&e&&(s.xp6(1),s.Q6J("ngForOf",(null==t.schema?null:t.schema.geminiForm)||s.DdM(1,q)))},directives:[r.gY,n.sg,r.Gk,r.gW,n.RF,n.n9,n.ED,o.EJ,o.JJ,o.On,o.YN,o.Kr,o.Fj],pipes:[y],styles:[""]}),e})();var z=i(6867);function O(e){return t=>t.lift(new _(e))}class _{constructor(e){this.value=e}call(e,t){return t.subscribe(new N(e,this.value))}}class N extends z.L{constructor(e,t){super(e),this.value=t}_next(e){this.destination.next(this.value)}}let J=(()=>{class e{constructor(e){this.auditService=e}create(e,t){const{id:i,mod:n}=this.auditService.randomIdAndMod(),r=Object.assign({id:i,mod:n,usn:0,name:"",typeId:[]},t);return this.auditService.update(e.objectId,{[`zone.${i}`]:r}).pipe(O(r))}update(e,t,i){const n={};for(const[r,a]of Object.entries(i))n[`zone.${t}.${r}`]=a;return this.auditService.update(e.objectId,n)}delete(e,{id:t,typeId:i}){const n={[`zone.${t}`]:{__op:"Delete"}};for(const r of i)n[`type.${r}`]={__op:"Delete"};return this.auditService.update(e.objectId,n)}}return e.\u0275fac=function(t){return new(t||e)(s.LFG(m))},e.\u0275prov=s.Yz7({token:e,factory:e.\u0275fac}),e})();const C=["*"];let F=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=s.Xpm({type:e,selectors:[["app-options-dropdown"]],inputs:{id:"id"},ngContentSelectors:C,decls:5,vars:2,consts:[["ngbDropdown","","placement","bottom-right","container","body",3,"click"],["ngbDropdownToggle","",1,"btn","btn-secondary","btn-sm",3,"id"],["ngbDropdownMenu",""]],template:function(e,t){1&e&&(s.F$t(),s.TgZ(0,"div",0),s.NdJ("click",function(e){return e.stopPropagation(),e.preventDefault()}),s.TgZ(1,"button",1),s._uU(2," Options "),s.qZA(),s.TgZ(3,"div",2),s.Hsn(4),s.qZA(),s.qZA()),2&e&&(s.xp6(1),s.MGl("id","actions-dropdown-",t.id,""),s.xp6(2),s.uIk("aria-labelledby","actions-dropdown-"+t.id))},directives:[r.jt,r.iD,r.Vi],styles:[""]}),e})();const U=function(e){return[e]};function Y(e,t){if(1&e){const e=s.EpF();s.TgZ(0,"a",3),s.TgZ(1,"div",4),s._uU(2),s.qZA(),s.TgZ(3,"app-options-dropdown",5),s.TgZ(4,"button",6),s.NdJ("click",function(){const t=s.CHM(e).$implicit;return s.oxw().rename(t.value)}),s._uU(5,"Rename"),s.qZA(),s._UZ(6,"div",7),s.TgZ(7,"button",8),s.NdJ("click",function(){const t=s.CHM(e).$implicit;return s.oxw().delete(t.value)}),s._uU(8,"Delete"),s.qZA(),s.qZA(),s.qZA()}if(2&e){const e=t.$implicit,i=s.oxw();s.Q6J("routerLink",s.VKq(3,U,i.routerPrefix+e.value.id)),s.xp6(2),s.hij(" ",e.value.name," "),s.xp6(1),s.Q6J("id",e.value.id)}}let M=(()=>{class e{constructor(e,t,i){this.auditService=e,this.zoneService=t,this.featureService=i,this.routerPrefix=""}createZone(){const e=prompt("New Zone Name");e&&this.zoneService.create(this.audit,{name:e}).subscribe(e=>{this.audit.zone[e.id]=e})}rename(e){const t=prompt("Rename Zone",e.name);t&&this.zoneService.update(this.audit,e.id,{name:t}).subscribe(()=>{e.name=t})}delete(e){confirm(`Are you sure you want to delete '${e.name}'?`)&&(this.zoneService.delete(this.audit,e).subscribe(()=>{delete this.audit.zone[e.id];for(const t of e.typeId)delete this.audit.type[t]}),this.featureService.deleteAll({zoneId:e.id.toString()}).subscribe())}}return e.\u0275fac=function(t){return new(t||e)(s.Y36(m),s.Y36(J),s.Y36(v))},e.\u0275cmp=s.Xpm({type:e,selectors:[["app-zone-list"]],inputs:{audit:"audit",routerPrefix:"routerPrefix"},decls:5,vars:3,consts:[[1,"list-group","rounded-0"],[1,"list-group-item","list-group-item-action","text-success",3,"click"],["class","list-group-item list-group-item-action d-flex align-items-center","routerLinkActive","active",3,"routerLink",4,"ngFor","ngForOf"],["routerLinkActive","active",1,"list-group-item","list-group-item-action","d-flex","align-items-center",3,"routerLink"],[1,"flex-grow-1"],[1,"visible-hover",3,"id"],["ngbDropdownItem","",3,"click"],[1,"dropdown-divider"],["ngbDropdownItem","",1,"text-danger",3,"click"]],template:function(e,t){1&e&&(s.TgZ(0,"div",0),s.TgZ(1,"button",1),s.NdJ("click",function(){return t.createZone()}),s._uU(2," New Zone "),s.qZA(),s.YNc(3,Y,9,5,"a",2),s.ALo(4,"keyvalue"),s.qZA()),2&e&&(s.xp6(3),s.Q6J("ngForOf",s.lcZ(4,1,t.audit.zone)))},directives:[n.sg,u.yS,u.Od,F,r.TH],pipes:[n.Nd],styles:[""]}),e})();const j=["form"];function $(e,t){if(1&e){const e=s.EpF();s.TgZ(0,"app-form",10,11),s.NdJ("dataChanged",function(t){return s.CHM(e),s.oxw(2).save(t)}),s.qZA()}if(2&e){const e=s.oxw(2);s.Q6J("data",e.data)}}function L(e,t){if(1&e&&(s.TgZ(0,"div",0),s.YNc(1,$,2,1,"app-form",9),s.qZA()),2&e){const e=s.oxw();s.xp6(1),s.Q6J("ngIf",e.selectedAudit)}}function Q(e,t){if(1&e&&s._UZ(0,"app-zone-list",12),2&e){const e=s.oxw();s.Q6J("audit",e.selectedAudit)}}let D=(()=>{class e{constructor(e,t,i){this.auditService=e,this.featureService=t,this.route=i,this.data={},this.activeTab="preaudit"}ngOnInit(){this.route.params.pipe((0,h.w)(({aid:e})=>(0,g.D)([this.auditService.findAll({auditId:e}),this.featureService.findAll({auditId:e,belongsTo:"preaudit"})]))).subscribe(([e,t])=>{this.selectedAudit=e[0],this.feature=t[0],this.data=t[0]?this.featureService.feature2Data(t[0]):{}})}isSaved(){var e;return!(null===(e=this.form)||void 0===e?void 0:e.dirty)}save(e){if(this.feature){const t=this.featureService.data2Feature(e);return void this.featureService.update(this.feature.objectId,t).subscribe()}const{formId:t,values:i}=this.featureService.data2Feature(e);this.featureService.create({auditId:this.selectedAudit.auditId,belongsTo:"preaudit",mod:(new Date).valueOf().toString(),zoneId:null,typeId:null,usn:0,formId:t,values:i}).subscribe(e=>{this.feature=e})}}return e.\u0275fac=function(t){return new(t||e)(s.Y36(m),s.Y36(v),s.Y36(u.gz))},e.\u0275cmp=s.Xpm({type:e,selectors:[["app-audit"]],viewQuery:function(e,t){if(1&e&&s.Gf(j,5),2&e){let e;s.iGM(e=s.CRH())&&(t.form=e.first)}},decls:15,vars:3,consts:[[1,"container"],["routerLink","..",1,"bi-chevron-left","d-lg-none"],["ngbNav","",1,"nav-tabs",3,"activeId","activeIdChange"],["nav","ngbNav"],["ngbNavItem","preaudit"],["ngbNavLink",""],["ngbNavContent",""],["ngbNavItem","zone"],[1,"mt-2",3,"ngbNavOutlet"],["type","preaudit",3,"data","dataChanged",4,"ngIf"],["type","preaudit",3,"data","dataChanged"],["form",""],["routerPrefix","zones/",3,"audit"]],template:function(e,t){if(1&e&&(s.TgZ(0,"div",0),s.TgZ(1,"h1"),s._UZ(2,"a",1),s._uU(3),s.qZA(),s.TgZ(4,"ul",2,3),s.NdJ("activeIdChange",function(e){return t.activeTab=e}),s.TgZ(6,"li",4),s.TgZ(7,"a",5),s._uU(8,"Preaudit"),s.qZA(),s.YNc(9,L,2,1,"ng-template",6),s.qZA(),s.TgZ(10,"li",7),s.TgZ(11,"a",5),s._uU(12,"Zone"),s.qZA(),s.YNc(13,Q,1,1,"ng-template",6),s.qZA(),s.qZA(),s._UZ(14,"div",8),s.qZA()),2&e){const e=s.MAs(5);s.xp6(3),s.hij(" ",null==t.selectedAudit?null:t.selectedAudit.name," "),s.xp6(1),s.Q6J("activeId",t.activeTab),s.xp6(10),s.Q6J("ngbNavOutlet",e)}},directives:[u.yS,r.Pz,r.nv,r.Vx,r.uN,r.tO,n.O5,k,M],styles:[""]}),e})();const H=[[["","breadcrumb",""]],[["","list",""]]],P=function(){return{exact:!0}},B=["[breadcrumb]","[list]"];let E=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=s.Xpm({type:e,selectors:[["app-master-detail"]],ngContentSelectors:B,decls:7,vars:2,consts:[[1,"row","no-gutters","h-100"],["routerLinkActive","master-active",1,"col-lg-3","h-100","overflow-auto","master",3,"routerLinkActiveOptions"],["routerLink",".",1,"d-none"],[1,"col-lg-9","h-100","overflow-auto","detail"]],template:function(e,t){1&e&&(s.F$t(H),s.TgZ(0,"div",0),s.TgZ(1,"div",1),s._UZ(2,"a",2),s.Hsn(3),s.Hsn(4,1),s.qZA(),s.TgZ(5,"div",3),s._UZ(6,"router-outlet"),s.qZA(),s.qZA()),2&e&&(s.xp6(1),s.Q6J("routerLinkActiveOptions",s.DdM(1,P)))},directives:[u.Od,u.yS,u.lC],styles:["@media (max-width: 991px){.master-active[_ngcontent-%COMP%] + .detail[_ngcontent-%COMP%], .master[_ngcontent-%COMP%]:not(.master-active){display:none!important}}"]}),e})();const R=function(e){return[e]};function X(e,t){if(1&e){const e=s.EpF();s.TgZ(0,"a",6),s.TgZ(1,"div",7),s._uU(2),s.qZA(),s.TgZ(3,"app-options-dropdown",8),s.TgZ(4,"button",9),s.NdJ("click",function(){const t=s.CHM(e).$implicit;return s.oxw().rename(t)}),s._uU(5,"Rename"),s.qZA(),s._UZ(6,"div",10),s.TgZ(7,"button",11),s.NdJ("click",function(){const t=s.CHM(e).$implicit;return s.oxw().delete(t)}),s._uU(8,"Delete"),s.qZA(),s.qZA(),s.qZA()}if(2&e){const e=t.$implicit;s.Q6J("routerLink",s.VKq(3,R,e.auditId)),s.xp6(2),s.hij(" ",e.name," "),s.xp6(1),s.Q6J("id",e.auditId)}}let G=(()=>{class e{constructor(e,t){this.auditService=e,this.featureService=t,this.audits=[]}ngOnInit(){this.auditService.findAll().subscribe(e=>{this.audits=e})}create(){const e=prompt("New Audit Name");e&&this.auditService.create({name:e,type:{},zone:{}}).subscribe(e=>{this.audits.push(e)})}rename(e){const t=prompt("Rename Audit",e.name);t&&this.auditService.update(e.objectId,{name:t}).subscribe(()=>{e.name=t})}delete(e){confirm(`Are you sure you want to delete '${e.name}'?`)&&(this.auditService.delete(e).subscribe(()=>{const t=this.audits.indexOf(e);t>=0&&this.audits.splice(t,1)}),this.featureService.deleteAll({auditId:e.auditId}).subscribe())}}return e.\u0275fac=function(t){return new(t||e)(s.Y36(m),s.Y36(v))},e.\u0275cmp=s.Xpm({type:e,selectors:[["app-pre-audit"]],decls:9,vars:1,consts:[["breadcrumb","","aria-label","breadcrumb"],[1,"breadcrumb"],["aria-current","page",1,"breadcrumb-item","active"],["list","",1,"list-group","rounded-0"],[1,"list-group-item","list-group-item-action","text-success",3,"click"],["class","list-group-item list-group-item-action d-flex align-items-center","routerLinkActive","active text-white",3,"routerLink",4,"ngFor","ngForOf"],["routerLinkActive","active text-white",1,"list-group-item","list-group-item-action","d-flex","align-items-center",3,"routerLink"],[1,"flex-grow-1"],[1,"visible-hover",3,"id"],["ngbDropdownItem","",3,"click"],[1,"dropdown-divider"],["ngbDropdownItem","",1,"text-danger",3,"click"]],template:function(e,t){1&e&&(s.TgZ(0,"app-master-detail"),s.TgZ(1,"nav",0),s.TgZ(2,"ol",1),s.TgZ(3,"li",2),s._uU(4,"Audits"),s.qZA(),s.qZA(),s.qZA(),s.TgZ(5,"div",3),s.TgZ(6,"button",4),s.NdJ("click",function(){return t.create()}),s._uU(7," New Audit "),s.qZA(),s.YNc(8,X,9,5,"a",5),s.qZA(),s.qZA()),2&e&&(s.xp6(8),s.Q6J("ngForOf",t.audits))},directives:[E,n.sg,u.yS,u.Od,F,r.TH],styles:[""]}),e})();var V=i(3561);const W=[{id:"plugload",name:"Plugload",subTypes:[{id:"combination_oven",name:"Combination Oven"},{id:"convection_oven",name:"Convection Oven"},{id:"conveyor_oven",name:"Conveyor Oven"},{id:"fryer",name:"Fryer"},{id:"icemaker",name:"Ice Maker"},{id:"rack_oven",name:"Rack Oven"},{id:"steam_cooker",name:"Steam Cooker"},{id:"griddle",name:"Griddle"},{id:"hot_food_cabinet",name:"Hot Food Cabinet"},{id:"conveyor_broiler",name:"Conveyor Broiler"},{id:"dishwasher",name:"Dish Washer"},{id:"pre_rinse_spray",name:"Pre Rinse Spray"},{id:"sample_appliance",name:"Sample Appliance"}]},{id:"hvac",name:"HVAC"},{id:"hotwater",name:"WaterHeater"},{id:"refrigeration",name:"Refrigeration",subTypes:[{id:"walkin_refrigerator",name:"Walk-In Refrigerator"},{id:"walkin_freezer",name:"Walk-In Freezer"},{id:"refrigerator",name:"Refrigerator"},{id:"freezer",name:"Freezer"},{id:"walkin_coolbot",name:"Walk-In Cooler Box"}]},{id:"lighting",name:"Lighting",subTypes:[{id:"halogen",name:"Halogen"},{id:"cfl",name:"CFL"},{id:"linearfluorescent",name:"Linear Fluorescent"},{id:"incandescent",name:"Incandescent"},{id:"hpsodium",name:"High Pressure Sodium"},{id:"lpsodium",name:"Low Pressure Sodium"}]},{id:"motors",name:"Motors"},{id:"others",name:"Others"}];let K=(()=>{class e{constructor(e){this.auditService=e}create(e,t,i){const{id:n,mod:r}=this.auditService.randomIdAndMod(),a=Object.assign({id:n,mod:r,usn:0,zoneId:t.id},i);return this.auditService.update(e.objectId,{[`type.${n}`]:a,[`zone.${t.id}.typeId`]:{__op:"AddUnique",objects:[n]}}).pipe(O(a))}update(e,t,i){const n={};for(const[r,a]of Object.entries(i))n[`type.${t}.${r}`]=a;return this.auditService.update(e.objectId,n)}delete(e,t,i){return this.auditService.update(e.objectId,{[`type.${i}`]:{__op:"Delete"},[`zone.${t}.typeId`]:{__op:"Remove",objects:[i]}})}}return e.\u0275fac=function(t){return new(t||e)(s.LFG(m))},e.\u0275prov=s.Yz7({token:e,factory:e.\u0275fac}),e})();function ee(e,t){if(1&e){const e=s.EpF();s.TgZ(0,"button",4),s.NdJ("click",function(){s.CHM(e);const t=s.oxw();return t.createType(t.type)}),s._uU(1),s.qZA()}if(2&e){const e=s.oxw();s.xp6(1),s.hij(" New ",e.type.name," ")}}function te(e,t){if(1&e){const e=s.EpF();s.TgZ(0,"button",7),s.NdJ("click",function(){const t=s.CHM(e).$implicit,i=s.oxw(2);return i.createType(i.type,t)}),s._uU(1),s.qZA()}if(2&e){const e=t.$implicit;s.xp6(1),s.hij(" ",e.name," ")}}function ie(e,t){if(1&e&&(s.TgZ(0,"details",5),s.TgZ(1,"summary"),s._uU(2,"New"),s.qZA(),s.YNc(3,te,2,1,"button",6),s.qZA()),2&e){const e=s.oxw();s.xp6(3),s.Q6J("ngForOf",e.type.subTypes)}}const ne=function(e){return[e]};function re(e,t){if(1&e){const e=s.EpF();s.TgZ(0,"a",8),s.TgZ(1,"div",9),s._uU(2),s.TgZ(3,"small",10),s._uU(4),s.qZA(),s.qZA(),s.TgZ(5,"app-options-dropdown",11),s.TgZ(6,"button",12),s.NdJ("click",function(){const t=s.CHM(e).$implicit;return s.oxw().rename(t)}),s._uU(7,"Rename"),s.qZA(),s._UZ(8,"div",13),s.TgZ(9,"button",14),s.NdJ("click",function(){const t=s.CHM(e).$implicit;return s.oxw().delete(t)}),s._uU(10,"Delete"),s.qZA(),s.qZA(),s.qZA()}if(2&e){const e=t.$implicit,i=s.oxw();s.Q6J("routerLink",s.VKq(4,ne,i.routerPrefix+e.id)),s.xp6(2),s.hij(" ",e.name," "),s.xp6(2),s.Oqu(e.subtype),s.xp6(1),s.Q6J("id",e.id)}}let ae=(()=>{class e{constructor(e,t,i){this.auditService=e,this.typeService=t,this.featureService=i,this.routerPrefix=""}createType(e,t){var i,n;const r=prompt(`New ${null!==(i=null==t?void 0:t.name)&&void 0!==i?i:e.name} Name`);r&&this.typeService.create(this.audit,this.zone,{type:e.name,subtype:null!==(n=null==t?void 0:t.name)&&void 0!==n?n:null,name:r}).subscribe(e=>{this.zone.typeId.push(e.id),this.audit.type[e.id]=e,this.types.push(e)})}rename(e){const t=prompt("Rename Type",e.name);t&&this.typeService.update(this.audit,e.id,{name:t}).subscribe(()=>{e.name=t})}delete(e){confirm(`Are you sure you want to delete '${e.name}'?`)&&(this.typeService.delete(this.audit,e.zoneId,e.id).subscribe(()=>{delete this.audit.type[e.id];const t=this.audit.zone[e.zoneId].typeId,i=t.indexOf(e.id);i>=0&&t.splice(i,1);const n=this.types.indexOf(e);n>=0&&this.types.splice(n,1)}),this.featureService.deleteAll({typeId:e.id.toString()}).subscribe())}}return e.\u0275fac=function(t){return new(t||e)(s.Y36(m),s.Y36(K),s.Y36(v))},e.\u0275cmp=s.Xpm({type:e,selectors:[["app-type-list"]],inputs:{audit:"audit",zone:"zone",types:"types",type:"type",routerPrefix:"routerPrefix"},decls:4,vars:3,consts:[[1,"list-group","rounded-0"],["class","list-group-item list-group-item-action text-success",3,"click",4,"ngIf"],["class","list-group-item text-success",4,"ngIf"],["class","list-group-item list-group-item-action d-flex align-items-center","routerLinkActive","active text-white",3,"routerLink",4,"ngFor","ngForOf"],[1,"list-group-item","list-group-item-action","text-success",3,"click"],[1,"list-group-item","text-success"],["class","btn btn-sm btn-link text-success",3,"click",4,"ngFor","ngForOf"],[1,"btn","btn-sm","btn-link","text-success",3,"click"],["routerLinkActive","active text-white",1,"list-group-item","list-group-item-action","d-flex","align-items-center",3,"routerLink"],[1,"flex-grow-1"],[1,"text-muted"],[1,"visible-hover",3,"id"],["ngbDropdownItem","",3,"click"],[1,"dropdown-divider"],["ngbDropdownItem","",1,"text-danger",3,"click"]],template:function(e,t){1&e&&(s.TgZ(0,"div",0),s.YNc(1,ee,2,1,"button",1),s.YNc(2,ie,4,1,"details",2),s.YNc(3,re,11,6,"a",3),s.qZA()),2&e&&(s.xp6(1),s.Q6J("ngIf",!t.type.subTypes),s.xp6(1),s.Q6J("ngIf",t.type.subTypes),s.xp6(1),s.Q6J("ngForOf",t.types))},directives:[n.O5,n.sg,u.yS,u.Od,F,r.TH],styles:[""]}),e})();function oe(e,t){if(1&e&&s._UZ(0,"app-type-list",9),2&e){const e=s.oxw();s.Q6J("audit",e.audit)("zone",e.zone)("types",e.types)("type",e.type)}}let se=(()=>{class e{constructor(e,t){this.route=e,this.auditService=t,this.types=[]}ngOnInit(){this.route.params.pipe((0,h.w)(({aid:e,zid:t,type:i})=>this.auditService.findAll({auditId:e}).pipe((0,p.U)(e=>e[0]),(0,V.b)(e=>{this.type=W.find(e=>e.name===i),this.audit=e,this.zone=e.zone[t],this.types=Object.values(e.type).filter(e=>e.type===i&&e.zoneId==t)})))).subscribe()}}return e.\u0275fac=function(t){return new(t||e)(s.Y36(u.gz),s.Y36(m))},e.\u0275cmp=s.Xpm({type:e,selectors:[["app-pre-type"]],decls:18,vars:4,consts:[["breadcrumb","","aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item"],["routerLink","../../../.."],["routerLink","../../.."],["routerLink","../.."],["routerLink",".."],["aria-current","page",1,"breadcrumb-item","active"],["list","",3,"audit","zone","types","type",4,"ngIf"],["list","",3,"audit","zone","types","type"]],template:function(e,t){1&e&&(s.TgZ(0,"app-master-detail"),s.TgZ(1,"nav",0),s.TgZ(2,"ol",1),s.TgZ(3,"li",2),s.TgZ(4,"a",3),s._uU(5,"Audits"),s.qZA(),s.qZA(),s.TgZ(6,"li",2),s.TgZ(7,"a",4),s._uU(8),s.qZA(),s.qZA(),s.TgZ(9,"li",2),s.TgZ(10,"a",5),s._uU(11,"Zones"),s.qZA(),s.qZA(),s.TgZ(12,"li",2),s.TgZ(13,"a",6),s._uU(14),s.qZA(),s.qZA(),s.TgZ(15,"li",7),s._uU(16),s.qZA(),s.qZA(),s.qZA(),s.YNc(17,oe,1,4,"app-type-list",8),s.qZA()),2&e&&(s.xp6(8),s.Oqu(null==t.audit?null:t.audit.name),s.xp6(6),s.Oqu(null==t.zone?null:t.zone.name),s.xp6(2),s.Oqu(null==t.type?null:t.type.name),s.xp6(1),s.Q6J("ngIf",t.type&&t.audit&&t.zone&&t.types))},directives:[E,u.yS,n.O5,ae],styles:[""]}),e})();function ce(e,t){if(1&e&&s._UZ(0,"app-zone-list",7),2&e){const e=s.oxw();s.Q6J("audit",e.audit)}}let ue=(()=>{class e{constructor(e,t){this.route=e,this.auditService=t}ngOnInit(){this.route.params.pipe((0,h.w)(({aid:e})=>this.auditService.findAll({auditId:e}))).subscribe(e=>{this.audit=e[0]})}}return e.\u0275fac=function(t){return new(t||e)(s.Y36(u.gz),s.Y36(m))},e.\u0275cmp=s.Xpm({type:e,selectors:[["app-pre-zone"]],decls:12,vars:2,consts:[["breadcrumb","","aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item"],["routerLink","../.."],["routerLink",".."],["aria-current","page",1,"breadcrumb-item","active"],["list","",3,"audit",4,"ngIf"],["list","",3,"audit"]],template:function(e,t){1&e&&(s.TgZ(0,"app-master-detail"),s.TgZ(1,"nav",0),s.TgZ(2,"ol",1),s.TgZ(3,"li",2),s.TgZ(4,"a",3),s._uU(5,"Audits"),s.qZA(),s.qZA(),s.TgZ(6,"li",2),s.TgZ(7,"a",4),s._uU(8),s.qZA(),s.qZA(),s.TgZ(9,"li",5),s._uU(10,"Zones"),s.qZA(),s.qZA(),s.qZA(),s.YNc(11,ce,1,1,"app-zone-list",6),s.qZA()),2&e&&(s.xp6(8),s.Oqu(null==t.audit?null:t.audit.name),s.xp6(3),s.Q6J("ngIf",t.audit))},directives:[E,u.yS,n.O5,M],styles:[""]}),e})();const de=["form"];function pe(e,t){if(1&e){const e=s.EpF();s.TgZ(0,"app-form",4,5),s.NdJ("dataChanged",function(){s.CHM(e);const t=s.oxw();return t.save(t.data)}),s.qZA()}if(2&e){const e=s.oxw();s.Q6J("data",e.data)("type",e.schemaId)}}let le=(()=>{class e{constructor(e,t,i){this.auditService=e,this.featureService=t,this.route=i}ngOnInit(){this.route.params.pipe((0,h.w)(({aid:e,zid:t,tid:i})=>(0,g.D)([this.auditService.findAll({auditId:e}).pipe((0,p.U)(e=>e[0].type[i])),this.featureService.findAll({auditId:e,zoneId:t,typeId:i})]))).subscribe(([e,t])=>{this.type=e;const i=W.find(t=>t.name===e.type),n=e.subtype?i.subTypes.find(t=>t.name===e.subtype):i;this.schemaId=n.id,this.feature=t[0],this.data=this.feature?this.featureService.feature2Data(this.feature):{}})}isSaved(){var e;return!(null===(e=this.form)||void 0===e?void 0:e.dirty)}save(e){if(this.feature){const t=this.featureService.data2Feature(e);return void this.featureService.update(this.feature.objectId,t).subscribe()}const{formId:t,values:i}=this.featureService.data2Feature(e),{aid:n,zid:r,tid:a}=this.route.snapshot.params;this.featureService.create({auditId:n,zoneId:r,typeId:a,belongsTo:"type",mod:(new Date).valueOf().toString(),usn:0,formId:t,values:i}).subscribe(e=>{this.feature=e})}}return e.\u0275fac=function(t){return new(t||e)(s.Y36(m),s.Y36(v),s.Y36(u.gz))},e.\u0275cmp=s.Xpm({type:e,selectors:[["app-type"]],viewQuery:function(e,t){if(1&e&&s.Gf(de,5),2&e){let e;s.iGM(e=s.CRH())&&(t.form=e.first)}},decls:7,vars:3,consts:[[1,"container"],["routerLink","..",1,"bi-chevron-left","d-lg-none"],[1,"text-muted","small"],[3,"data","type","dataChanged",4,"ngIf"],[3,"data","type","dataChanged"],["form",""]],template:function(e,t){1&e&&(s.TgZ(0,"div",0),s.TgZ(1,"h1"),s._UZ(2,"a",1),s._uU(3),s.TgZ(4,"span",2),s._uU(5),s.qZA(),s.qZA(),s.YNc(6,pe,2,2,"app-form",3),s.qZA()),2&e&&(s.xp6(3),s.hij(" ",null==t.type?null:t.type.name," "),s.xp6(2),s.hij(" ",null==t.type?null:t.type.subtype," "),s.xp6(1),s.Q6J("ngIf",t.data))},directives:[u.yS,n.O5,k],styles:[""]}),e})();function me(e,t){if(1&e&&s._UZ(0,"app-type-list",9),2&e){const e=s.oxw().$implicit,t=s.oxw();s.Q6J("types",t.groupedTypes[e.name])("audit",t.audit)("zone",t.selectedZone)("type",e)("routerPrefix",e.name+"/")}}function fe(e,t){if(1&e&&(s.TgZ(0,"li",6),s.TgZ(1,"a",7),s._uU(2),s.qZA(),s.YNc(3,me,1,5,"ng-template",8),s.qZA()),2&e){const e=t.$implicit;s.Q6J("ngbNavItem",e.name),s.xp6(2),s.Oqu(e.name)}}const ge=[{path:"",component:G,children:[{path:":aid",component:D,canDeactivate:[f]}]},{path:":aid/zones",component:ue,children:[{path:":zid",component:(()=>{class e{constructor(e,t){this.auditService=e,this.route=t,this.types=W,this.groupedTypes={};for(const i of W)this.groupedTypes[i.name]=[]}ngOnInit(){this.route.params.pipe((0,h.w)(({aid:e,zid:t})=>this.auditService.findAll({auditId:e}).pipe((0,p.U)(e=>e[0]),(0,V.b)(e=>this.audit=e),(0,p.U)(e=>e.zone[t])))).subscribe(e=>{var t,i;this.selectedZone=e;const n=null!==(i=null===(t=this.selectedZone)||void 0===t?void 0:t.typeId.map(e=>this.audit.type[e]))&&void 0!==i?i:[];for(const r of n)this.groupedTypes[r.type].push(r)})}}return e.\u0275fac=function(t){return new(t||e)(s.Y36(m),s.Y36(u.gz))},e.\u0275cmp=s.Xpm({type:e,selectors:[["app-zone"]],decls:8,vars:4,consts:[[1,"container"],["routerLink","..",1,"bi-chevron-left","d-lg-none"],["ngbNav","",1,"nav-tabs",3,"activeId","activeIdChange"],["nav","ngbNav"],[3,"ngbNavItem",4,"ngFor","ngForOf"],[1,"mt-2",3,"ngbNavOutlet"],[3,"ngbNavItem"],["ngbNavLink",""],["ngbNavContent",""],[3,"types","audit","zone","type","routerPrefix"]],template:function(e,t){if(1&e&&(s.TgZ(0,"div",0),s.TgZ(1,"h1"),s._UZ(2,"a",1),s._uU(3),s.qZA(),s.TgZ(4,"ul",2,3),s.NdJ("activeIdChange",function(e){return t.activeTab=e}),s.YNc(6,fe,4,2,"li",4),s.qZA(),s._UZ(7,"div",5),s.qZA()),2&e){const e=s.MAs(5);s.xp6(3),s.hij(" ",null==t.selectedZone?null:t.selectedZone.name," "),s.xp6(1),s.Q6J("activeId",t.activeTab),s.xp6(2),s.Q6J("ngForOf",t.types),s.xp6(1),s.Q6J("ngbNavOutlet",e)}},directives:[u.yS,r.Pz,n.sg,r.tO,r.nv,r.Vx,r.uN,ae],styles:[""]}),e})()}]},{path:":aid/zones/:zid/:type",component:se,children:[{path:":tid",component:le,canDeactivate:[f]}]}];let he=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=s.oAB({type:e}),e.\u0275inj=s.cJS({imports:[[u.Bz.forChild(ge)],u.Bz]}),e})(),ve=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=s.oAB({type:e}),e.\u0275inj=s.cJS({providers:[m,J,K,v],imports:[[n.ez,d,c,r.Oz,r.XC,he]]}),e})()}}]);